[33mcommit fccbe4d4d304dac22c883a27f33fcafc61c145ef[m
Author: Yipalgaming <semantatay@gmail.com>
Date:   Thu Oct 23 01:19:09 2025 +0800

    Fix linter errors: accessibility labels, code quality issues, and unreachable code

[1mdiff --git a/app.py b/app.py[m
[1mindex 144edd3..64765fd 100644[m
[1m--- a/app.py[m
[1m+++ b/app.py[m
[36m@@ -37,7 +37,6 @@[m [mapp.config.from_object(config[config_name])[m
 # Initialize extensions[m
 db.init_app(app)[m
 migrate = Migrate(app, db)[m
[31m-# csrf = CSRFProtect(app)  # Temporarily disabled for testing[m
 [m
 login_manager = LoginManager()[m
 login_manager.init_app(app)[m
[36m@@ -111,7 +110,7 @@[m [mdef sanitize_input(text):[m
     return html.escape(text.strip())[m
 [m
 # Rate limiting decorator[m
[31m-def rate_limit(max_requests=99, window=60):[m
[32m+[m[32mdef rate_limit(max_requests=5, window=300):[m
     """Rate limiting decorator"""[m
     def decorator(f):[m
         @wraps(f)[m
[36m@@ -424,7 +423,7 @@[m [mdef parent_register():[m
     return render_template('parent_register.html')[m
 [m
 @app.route('/parent/login', methods=['GET', 'POST'])[m
[31m-@rate_limit(max_requests=99, window=300)[m
[32m+[m[32m@rate_limit(max_requests=5, window=300)[m
 @add_security_headers[m
 def parent_login():[m
     print(f"Parent login route accessed, method: {request.method}")[m
[36m@@ -986,10 +985,10 @@[m [mdef handle_order_submission():[m
         flash(f"‚ùå {str(e)}", "error")[m
         return redirect(url_for("order"))[m
 [m
[31m-        student = StudentInfo.query.get(current_user.id)[m
[31m-        if not student:[m
[31m-            flash("‚ùå Student not found.", "error")[m
[31m-            return redirect(url_for("order"))[m
[32m+[m[32m    student = StudentInfo.query.get(current_user.id)[m
[32m+[m[32m    if not student:[m
[32m+[m[32m        flash("‚ùå Student not found.", "error")[m
[32m+[m[32m        return redirect(url_for("order"))[m
 [m
     try:[m
         orders_created = create_orders_from_cart(cart_items, student.id)[m
[36m@@ -1269,22 +1268,22 @@[m [mdef topup():[m
             flash(ACCOUNT_FROZEN, "error")[m
             return redirect(url_for("topup"))[m
 [m
[31m-            try:[m
[31m-                amount_int = int(amount)[m
[31m-                student.balance += amount_int[m
[31m-            [m
[31m-                new_tx = Transaction([m
[31m-                type="Top-up",[m
[31m-                amount=amount_int,  # Fixed: use int instead of string[m
[31m-                description=f"Top-up for {student.name}"[m
[31m-                )[m
[31m-                db.session.add(new_tx)[m
[31m-                db.session.commit()[m
[31m-                flash(f"Successfully topped up RM{amount_int} for {student.name}.", "success")[m
[31m-            except Exception as e:[m
[31m-                db.session.rollback()[m
[31m-                app.logger.error(f"Top-up error: {str(e)}")[m
[31m-                flash("Error processing top-up. Please try again.", "error")[m
[32m+[m[32m        try:[m
[32m+[m[32m            amount_int = int(amount)[m
[32m+[m[32m            student.balance += amount_int[m
[32m+[m[41m        [m
[32m+[m[32m            new_tx = Transaction([m
[32m+[m[32m            type="Top-up",[m
[32m+[m[32m            amount=amount_int,  # Fixed: use int instead of string[m
[32m+[m[32m            description=f"Top-up for {student.name}"[m
[32m+[m[32m            )[m
[32m+[m[32m            db.session.add(new_tx)[m
[32m+[m[32m            db.session.commit()[m
[32m+[m[32m            flash(f"Successfully topped up RM{amount_int} for {student.name}.", "success")[m
[32m+[m[32m        except Exception as e:[m
[32m+[m[32m            db.session.rollback()[m
[32m+[m[32m            app.logger.error(f"Top-up error: {str(e)}")[m
[32m+[m[32m            flash("Error processing top-up. Please try again.", "error")[m
 [m
     return render_template("topup.html")[m
 [m
[1mdiff --git a/canteen_mobile/lib/main.dart b/canteen_mobile/lib/main.dart[m
[1mindex 2b7fe1e..49b855f 100644[m
[1m--- a/canteen_mobile/lib/main.dart[m
[1m+++ b/canteen_mobile/lib/main.dart[m
[36m@@ -66,15 +66,6 @@[m [mclass _WebViewAppState extends State<WebViewApp> {[m
     await Permission.microphone.request();[m
   }[m
 [m
[31m-  void _onTabTapped(int index) {[m
[31m-    setState(() {[m
[31m-      _currentIndex = index;[m
[31m-    });[m
[31m-    webViewController?.loadUrl([m
[31m-      urlRequest: URLRequest(url: WebUri(_navItems[index]['url'])),[m
[31m-    );[m
[31m-  }[m
[31m-[m
   @override[m
   Widget build(BuildContext context) {[m
     return Scaffold([m
[36m@@ -110,7 +101,7 @@[m [mclass _WebViewAppState extends State<WebViewApp> {[m
               setState(() {[m
                 isLoading = false;[m
                 hasError = true;[m
[31m-                errorMessage = message ?? 'Failed to load page';[m
[32m+[m[32m                errorMessage = message;[m
               });[m
             },[m
             androidOnPermissionRequest: (controller, origin, resources) async {[m
[1mdiff --git a/canteen_mobile/lib/main_enhanced.dart b/canteen_mobile/lib/main_enhanced.dart[m
[1mindex fdbfa8d..3aa19a0 100644[m
[1m--- a/canteen_mobile/lib/main_enhanced.dart[m
[1m+++ b/canteen_mobile/lib/main_enhanced.dart[m
[36m@@ -163,7 +163,7 @@[m [mclass _WebViewAppState extends State<WebViewApp> {[m
               setState(() {[m
                 isLoading = false;[m
                 hasError = true;[m
[31m-                errorMessage = message ?? 'Failed to load page';[m
[32m+[m[32m                errorMessage = message;[m
               });[m
             },[m
             onUpdateVisitedHistory: (controller, url, isReload) {[m
[1mdiff --git a/canteen_mobile/test/widget_test.dart b/canteen_mobile/test/widget_test.dart[m
[1mindex 060559b..88640e1 100644[m
[1m--- a/canteen_mobile/test/widget_test.dart[m
[1m+++ b/canteen_mobile/test/widget_test.dart[m
[36m@@ -13,7 +13,7 @@[m [mimport 'package:canteen_mobile/main.dart';[m
 void main() {[m
   testWidgets('Counter increments smoke test', (WidgetTester tester) async {[m
     // Build our app and trigger a frame.[m
[31m-    await tester.pumpWidget(const MyApp());[m
[32m+[m[32m    await tester.pumpWidget(MyApp());[m
 [m
     // Verify that our counter starts at 0.[m
     expect(find.text('0'), findsOneWidget);[m
[1mdiff --git a/templates/base.html b/templates/base.html[m
[1mindex ab4e820..0fc0b56 100644[m
[1m--- a/templates/base.html[m
[1m+++ b/templates/base.html[m
[36m@@ -228,7 +228,7 @@[m
     }[m
   </style>[m
 [m
[31m-<!--[m
[32m+[m
   {% if user.is_authenticated %}[m
     {% if user.role != 'staff' %}[m
   <script>[m
[36m@@ -237,20 +237,20 @@[m
     function resetLogoutTimer() {[m
       clearTimeout(logoutTimer);[m
       logoutTimer = setTimeout(() => {[m
[31m-      window.location.href = "{{ url_for('logout') }}";[m
[32m+[m[32m          globalThis.location.href = "{{ url_for('logout') }}";[m
       }, 2 * 60 * 1000);  // 2 minutes inactivity[m
     }[m
 [m
     // Events that reset timer[m
[31m-    ['click', 'mousemove', 'keypress', 'scroll'].forEach(evt =>[m
[31m-      window.addEventListener(evt, resetLogoutTimer)[m
[31m-    );[m
[32m+[m[32m         for (const evt of ['click', 'mousemove', 'keypress', 'scroll']) {[m
[32m+[m[32m           globalThis.addEventListener(evt, resetLogoutTimer);[m
[32m+[m[32m         }[m
 [m
     resetLogoutTimer(); // Start timer on load[m
   </script>[m
[31m-    {% endif %}[m
   {% endif %}[m
[31m--->[m
[32m+[m[32m  {% endif %}[m
[32m+[m
   [m
   <title>{% block title %}Nav Bar{% endblock %}</title>[m
 </head>[m
[36m@@ -271,7 +271,7 @@[m
             </div>[m
           </div>[m
           [m
[31m-          <nav class="space-y-2">[m
[32m+[m[32m          <nav class="space-y-2" aria-label="Main navigation">[m
             {% if user.role == 'student' %}[m
               <a href="{{ url_for('student_dashboard') }}" class="nav-item-modern">[m
                 <i class="fas fa-home"></i>[m
[36m@@ -405,7 +405,7 @@[m
 [m
 <!-- Bottom Navigation - visible only on mobile (< 768px) -->[m
 {% if user.is_authenticated %}[m
[31m-<nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 md:hidden z-50" id="bottom-nav">[m
[32m+[m[32m<nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 md:hidden z-50" id="bottom-nav" aria-label="Mobile navigation">[m
   <div class="flex justify-around items-center h-16">[m
     {% if user.role == 'student' %}[m
       <a href="{{ url_for('student_dashboard') }}" class="flex flex-col items-center justify-center flex-1 text-gray-600 hover:text-indigo-600 transition-colors">[m
[36m@@ -499,15 +499,15 @@[m [mdocument.addEventListener('click', function(event) {[m
   const sidebar = document.getElementById('sidebar');[m
   const toggleButton = event.target.closest('[onclick="toggleSidebar()"]');[m
   [m
[31m-  if (window.innerWidth <= 768 && !sidebar.contains(event.target) && !toggleButton) {[m
[32m+[m[32m  if (globalThis.innerWidth <= 768 && !sidebar.contains(event.target) && !toggleButton) {[m
     sidebar.classList.add('-translate-x-full');[m
   }[m
 });[m
 [m
 // Responsive sidebar behavior[m
[31m-window.addEventListener('resize', function() {[m
[32m+[m[32mglobalThis.addEventListener('resize', function() {[m
   const sidebar = document.getElementById('sidebar');[m
[31m-  if (window.innerWidth > 768) {[m
[32m+[m[32m  if (globalThis.innerWidth > 768) {[m
     sidebar.classList.remove('-translate-x-full');[m
   } else {[m
     sidebar.classList.add('-translate-x-full');[m
[36m@@ -517,7 +517,7 @@[m [mwindow.addEventListener('resize', function() {[m
 // Initialize sidebar state[m
 document.addEventListener('DOMContentLoaded', function() {[m
   const sidebar = document.getElementById('sidebar');[m
[31m-  if (window.innerWidth <= 768) {[m
[32m+[m[32m  if (globalThis.innerWidth <= 768) {[m
     sidebar.classList.add('-translate-x-full');[m
   }[m
 });[m
